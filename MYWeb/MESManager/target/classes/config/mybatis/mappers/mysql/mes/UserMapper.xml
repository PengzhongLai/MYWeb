<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.mes.mapper.UserMapper">

<!--根据账号密码查询用户信息-->
<select id="queryUserByLoginId" parameterType="hashmap" resultType="java.lang.Integer">
    SELECT count(*) from tb_sys_user
    WHERE loginId = #{loginId} AND password = #{password}

<!--下方已弃用-->
    <!--第一种写法-->
    <!--WHERE 1=1
    <if test="loginId !=null and loginId!='' ">
       and loginId=#{loginId}
    </if>
    <if test="password !=null and password!='' ">
        and password=#{password}
    </if>-->
    <!--第二种写法-->
<!--    <where>-->
<!--        <if test="loginId !=null and loginId!='' ">-->
<!--            and loginId=#{loginId}-->
<!--        </if>-->
<!--        and password=#{password}-->
<!--&lt;!&ndash;        <if test="password !=null and password!='' ">&ndash;&gt;-->
<!--&lt;!&ndash;            and password=#{password}&ndash;&gt;-->
<!--&lt;!&ndash;        </if>&ndash;&gt;-->
<!--    </where>-->

</select>

    <!--结果映射-->
    <resultMap id="user" type="com.mes.domain.User">
        <id column="loginId" property="loginId" />
        <result column="name" property="name" />
        <result column="phone" property="phone" />
        <result column="email" property="email" />
        <result column="userImgSrc" property="userImgSrc" />
        <result column="updateTime" property="updateTime" />
    </resultMap>
    <!--根据账号查询用户基本信息-->
    <select id="queryUserInfo" parameterType="hashmap" resultMap="user" >
        select
            a.loginId,
            b.`password`,
            a.`name`,
            a.phone,
            a.email,
            a.userImgSrc,
            a.updateTime
        from tb_sys_user_staff a
       LEFT JOIN tb_sys_user b on a.loginId=b.loginId
        where a.loginId=#{loginId}
    </select>

   <!--新增一条用户信息（保存账号和密码到tb_sys_user表）-->
    <insert id="addUser" parameterType="com.mes.domain.User" >
        INSERT into tb_sys_user
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="loginId !=null and loginId!='' ">
                loginId,
            </if>
            <if test="password !=null and password!='' ">
                password
            </if>
        </trim>
        <trim prefix="VALUES(" suffix=")" suffixOverrides=",">
            <if test="loginId !=null and loginId!='' ">
                #{loginId},
            </if>
            <if test="password !=null and password!='' ">
                #{password}
            </if>
        </trim>
    </insert>
    <!--新增一条用户信息（保存用户基本信息到tb_sys_user_staff表）-->
    <insert id="addUserStaff" parameterType="com.mes.domain.User">
        insert into tb_sys_user_staff
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="loginId !=null and loginId!='' ">
                loginId,
            </if>
            <if test="name !=null and name!='' ">
                name,
            </if>
            <if test="phone !=null and phone!='' ">
                phone,
            </if>
            <if test="email !=null and email!='' ">
                email
            </if>
        </trim>
        <trim prefix="VALUES(" suffix=")" suffixOverrides=",">

            <if test="loginId !=null and loginId!='' ">
                #{loginId},
            </if>
            <if test="name !=null and name!='' ">
                #{name},
            </if>
            <if test="phone !=null and phone!='' ">
                #{phone},
            </if>
            <if test="email !=null and email!='' ">
                #{email}
            </if>
        </trim>
    </insert>

    <!--根据账号修改一条用户信息（保存密码到tb_sys_user表）-->
    <update id="updateUser" parameterType="com.mes.domain.User">
        UPDATE tb_sys_user
        set password=#{password},
            updateTime=now()
        WHERE loginId=#{loginId}
    </update>

    <!--根据账号修改一条用户信息（保存用户基本信息到tb_sys_user_staff表）-->
    <update id="updateUserStaff" parameterType="com.mes.domain.User">
        UPDATE tb_sys_user_staff
        set
        <if test="name !=null and name!='' ">
            name=#{name},
        </if>
        <if test="phone !=null and phone!=''">
            phone=#{phone},
        </if>
        <if test="email !=null and email!=''">
            email=#{email},
        </if>
            updateTime=now()
        WHERE loginId=#{loginId}
    </update>

    <!--根据账号删除一条tb_sys_user表中数据-->
    <delete id="deleteUserByLoginId" parameterType="hashmap" >
        DELETE from tb_sys_user
        WHERE loginId=#{loginId}
    </delete>
</mapper>